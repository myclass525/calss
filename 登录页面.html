<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        * {
            box-sizing: border-box;
        }
 
        body {
            margin: 0;
        }
 
        .main {
            position: relative;
        }
 
        .item {
            position: absolute;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 0;
            transition: left .3s, top .3s, transform .3s;
            /* åŠ¨ç”»å±æ€§ */
        }
 
        /* å¦‚æœè¢«å‹åœ¨åº•ä¸‹çš„é¢œè‰²  åº”è¯¥æ˜¯ä¸€ç§ç°è‰² */
        .item:after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            transition: background-color .2s;
            /* è¢«é®è”½çš„å¡ç‰‡ åœ¨å‡ºç°çš„æ—¶å€™  ä»¥åŠ¨ç”»çš„å½¢å¼ */
        }
 
        /* è¿™ä¸ªæ˜¯ä¸ºäº†   å½“é…å¤Ÿ  æœ‰disabled å±æ€§çš„æ—¶å€™ å°±ä¼šé€æ˜æ‰ */
        .disabled:after {
            background-color: rgba(0, 0, 0, 0.7);
        }
 
        /* ç„¶å  ç»™æˆ‘ä»¬çš„è¿™ä¸ª æ¶ˆé™¤çš„å±•ç¤ºæ¡†é…ç½®ä¸€ä¸‹   é‡Œé¢æœ€å¤šèƒ½æ”¾6ä¸ª */
        .move-list {
            border: 1px solid #ddd;
            background-color: #ddd;
            margin: 0 auto;
        }
    </style>
</head>
 
<body>
    <!-- å¡ç‰Œæ¡† -->
    <div class="main"></div>
    <!-- æ¶ˆé™¤å±•ç¤ºæ¡† -->
    <div class="move-list"></div>
</body>
<script>
    const simpleData = [
        { name: 'æ¯›', color: '#ff1100' },
        { name: 'ç§€', color: '#ff8800' },
        { name: 'ä¸½', color: 'green' },
        { name: 'å±ˆ', color: '#779922' },
        { name: 'å‡¡', color: 'blue' },
        { name: 'å•¦', color: '#335577' },
        { name: 'ä½ ', color: 'lightblue' },
        { name: 'ğŸ‘‚', color: 'lightblue' }
    ]
    //å¡ç‰‡å¤§å°
    const size = 50
    //è¡Œ
    const rows = 10
    //åˆ—
    const cols = 10
    //3ä¸ªä¸€æ¶ˆé™¤
    const oneGroupCount = 3
    //æ¯ä¸ªæ¶ˆé™¤æœ‰6ç»„
    const group = 6
    //æ€»å…±6å±‚
    const layerCount = 6
    //å‚¨å­˜æ•°æ®çš„æ•°ç»„
    const cellHtml = []
    //æ•´ç†
    const renderData = Array.from(new Array(oneGroupCount * group)).map(v => {
        return simpleData.map(v => ({ ...v }))
    }).flat().sort(v => Math.random() - 0.5)  //åŠ ä¸Šflatæ˜¯ä¸ºäº†æŠŠäºŒç»´çš„æ‹‰æˆä¸€ç»´çš„   //æœ€åç”¨éšæœºæ•°æ‰“ä¹±ä¸€ä¸‹ 
 
    // console.log(renderData)
    //ä»¥ä¸Šç®€å•åœ°å‡†å¤‡äº†æˆ‘ä»¬æ‰€è¦ç”¨çš„æ•°æ®
 
    //ç¬¬ä¸€æ­¥ç”»è¡¨æ ¼
    //å…ˆç»˜åˆ¶  æœ€ä¸Šé¢ä¸€å±‚    ç„¶å  ä»é¡¶å±‚åˆ°åº•å±‚ç»˜åˆ¶  è¿›è¡Œè¡Œå’Œåˆ—çš„ æ•°æ®å¾ªç¯
    for (let ly = layerCount - 1; ly >= 0; ly--) {
        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                let pyStep = (ly + 1) % 2 === 0 ? size / 2 : 0   //ç»™åç§»é‡å’Œä¸ç»™åç§»é‡  å®ç°é”™å¼€çš„æ•ˆæœ
 
                //è¿›è¡Œ  å›¾å±‚çš„æ¸²æŸ“   id æ˜¯å¿…è¦çš„   è¿™ä¸ªå®šä¹‰äº† ç¬¬å‡ å±‚ly ç¬¬å‡ è¡Œ i ç¬¬å‡ åˆ—j  å¯ä»¥åˆ¤æ–­è¿™ä¸ªå¡ç‰‡æœ‰æ²¡æœ‰è¢«ç›–ä½
                //æœ€ç»ˆ  æˆ‘ä»¬ä¼šä»¥ç»å¯¹å®šä½çš„æ–¹å¼ è¿›è¡Œ å¸ƒå±€
                //æ•´ä¸ªéšæœºæ•°
                let item = (Math.random() > 0.7 && renderData.pop())  //å–å®Œéšæœºæ•°  ç„¶åç”¨pop  éšç”¨ éšåˆ   ç›´åˆ°æ²¡æœ‰ä¸ºæ­¢
                // if (item) {
                //     cellHtml.push(`<div class="item" id="m${ly}-${i}-${j}"
                //     style="width:${size}px;height:${size}px;left:${size * j + pyStep}px;top:${size * i + pyStep}px;
                //      background-color:${item.color}">${item.name}</div>`)
                // }
 
                item && cellHtml.push(`<div class="item" onclick="move(this)" id="m${ly}-${i}-${j}"
                    style="width:${size}px;height:${size}px;left:${size * j + pyStep}px;top:${size * i + pyStep}px;
                     background-color:${item.color}">${item.name}</div>`)
 
            }
        }
    }
    const main = document.querySelector('.main')
    const moveList = document.querySelector('.move-list')
 
    main.innerHTML = cellHtml.reverse().join('') //ç”¨reverseåè½¬ä¸€ä¸‹  ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿä»ä¸Šå¾€ä¸‹ç»˜åˆ¶
    //è®¾ç½®ä¸€ä¸‹å®¹å™¨çš„å®½é«˜
    main.style.height = `${size * rows + size * 2}px`
    //å®¹å™¨çš„é«˜å¯ä»¥ å¤šç»™ä¸€ç‚¹  ä¸ºäº†èƒ½å¤Ÿå®¹ä¸‹  æˆ‘ä»¬æ¶ˆé™¤çš„å±•ç¤ºæ¡†
    main.style.width = `${size * cols} px`
    moveList.style.height = `${size}px`
    moveList.style.width = `${size * 6}px`
    // -------------------------------------------------æˆªè‡³ä»¥ä¸Š  æˆ‘å°±å®Œæˆ  åˆæ­¥çš„é¡µé¢
    //------------æ¥ä¸‹æ¥è¿›è¡Œè®¡ç®—  è®¡ç®—å‡ºè¢«é®ä½çš„åº•ç‰Œ  å¹¶ä¸”æ ‡æ³¨æš—è‰²
    /* const checkDisabled = () => {
        main.querySelectorAll('.item').forEach((v, i) => {
            console.log(v);
            //å¤„ç†æ ¼å­
            const arr = v.id.substring(1).split('-').map(v => Number(v))
            const isPy = (arr[0] + 1) % 2 === 0
            for (let i = arr[0] + 1; i <= layerCount - 1; i++) {
                const isPyB = (i + 1) % 2 === 0
                if (isPy === isPyB) {
                    const el = main.querySelector(`#m${i}-${arr[1]}-${arr[2]}`)
                    if (el) {  //å¦‚æœelå­˜åœ¨å°±æ˜¯è¢«é®ç›–äº†
                        v.classList.add("disabled")
                        break//æ‰¾åˆ°  å°±ä¸å¾€ä¸‹æ‰¾äº†
                    } else if (isPy && !isPyB) {//æœ¬èº«æ˜¯2-4-6å½“å¯¹æ¯”å¯¹è±¡æ˜¯1-3-5çš„æƒ…å†µ
                        if (![
                            `${i}-${arr[1]}-${arr[2]}`,
                            `${i}-${arr[1]}-${arr[2] + 1}`,
                            `${i}-${arr[1] + 1}-${arr[2]}`,
                            `${i}-${arr[1] + 1}-${arr[2] + 1}` //åŠ 1æ˜¯ åç§»é‡
                        ].every(k => {
                            return !main.querySelector('#m' + k)
                        })) {
 
                            v.classList.add("disabled")
                            break
                        } else {
                            v.classList.remove("disabled")
                        }
 
                    } else if (!isPy && isPyB) {//æœ¬èº«æ˜¯1-3-5å½“å¯¹æ¯”å¯¹è±¡æ˜¯2-4-6çš„æƒ…å†µ
                        if (![
                            `${i}-${arr[1]}-${arr[2]}`,
                            `${i}-${arr[1]}-${arr[2] - 1}`,
                            `${i}-${arr[1] - 1}-${arr[2]}`,
                            `${i}-${arr[1] - 1}-${arr[2] - 1}`   //åŠ 1æ˜¯ åç§»é‡
                        ].every(k => {
                            return !main.querySelector('#m' + k)
                        })) {
                            v.classList.add("disabled")
                            break;
                        } else {
                            v.classList.remove("disabled")
                        }
                    }
                }
            }
        })
    } */
    //å°†ä¸Šé¢æ•´ç†  å¦‚ä¸‹ï¼š
    const checkDisabled = (items) => {
        (items || main.querySelectorAll('.item')).forEach((v, i) => {
            const arr = v.id.substring(1).split('-').map(v => Number(v))
            const isPy = (arr[0] + 1) % 2 === 0
            for (let i = arr[0] + 1; i <= layerCount - 1; i++) {
                const isPyB = (i + 1) % 2 === 0
                if (isPy === isPyB) {
                    const el = main.querySelector(`#m${i}-${arr[1]}-${arr[2]}`)
                    if (el) {
                        v.classList.add('disabled')
 
                        break;
                    }
                } else if (isPy && !isPyB) {
                    if (![
                        `${i}-${arr[1]}-${arr[2]}`,
                        `${i}-${arr[1]}-${arr[2] + 1}`,
                        `${i}-${arr[1] + 1}-${arr[2]}`,
                        `${i}-${arr[1] + 1}-${arr[2] + 1}`
                    ].every(k => {
                        return !main.querySelector('#m' + k)
                    })) {
                        v.classList.add('disabled')
                        break;
                    } else {
                        v.classList.remove('disabled')
                    }
 
                } else if (!isPy && isPyB) {
                    if (![
                        `${i}-${arr[1]}-${arr[2]}`,
                        `${i}-${arr[1]}-${arr[2] - 1}`,
                        `${i}-${arr[1] - 1}-${arr[2]}`,
                        `${i}-${arr[1] - 1}-${arr[2] - 1}`
                    ].every(k => {
                        return !main.querySelector('#m' + k)
                    })) {
                        v.classList.add('disabled')
                        break;
                    } else {
                        v.classList.remove('disabled')
                    }
 
                }
            }
        })
    }
    let canMove = true
 
    //ç¬¬ä¸‰æ­¥   ç‚¹å‡»å¡ç‰‡è¿›è¡Œæ¶ˆé™¤è®¡ç®—
    let move = (me) => {
        console.log(121212121);
        let left = moveList.offsetLeft  //
        let top = moveList.offsetTop    //
        if (!canMove || me.className.indexOf('disabled') >= 0) {
            return   //ç‚¹å‡»è¢«ç¦ç”¨çš„  ä»ç„¶ä¹Ÿæ²¡æœ‰ååº”
        }
        canMove = false
        if (moveList.children.length > 0) { //è¿™ä¸ªæ˜¯ç”¨æ¥åˆ¤æ–­  å½“ä¸‹é¢æ¶ˆé™¤æ¡†ä¸­æœ‰å…ƒç´ äº† 
            let el = moveList.lastElementChild
            left = el.offsetLeft + size    //æœ‰å…ƒç´ ä»¥å  å°±åç§»
        }
        me.style.top = `${top}px`
        me.style.left = `${left}px`  //åˆ°è¿™ä¸ºæ­¢  å°±å¯ä»¥é£˜ä¸‹å»äº†  ä½†æ˜¯åªèƒ½é£˜ä¸€ä¸ª   å› ä¸ºæˆ‘ä»¬æœ‰canMoveè¿™ä¸ªèŠ‚æµ
        //ä½†æ˜¯  æˆ‘ä»¬è®©é£˜ä¸‹å» ä»¥å ä¹Ÿè¦å°†èŠ‚ç‚¹è½¬ç§»ä¸‹å»
        me.transitionNamesCount = 0  //è®¡æ•°
        me.ontransitionend = (e) => {
            me.transitionNamesCount++
            if (me.transitionNamesCount === 2) {  //è¿™é‡Œå®šä¹‰2  æ˜¯å› ä¸º æˆ‘ä»¬ä¸Šé¢cssä¸­å®šä¹‰çš„åŠ¨ç”» æ¥çœ‹left  å’Œ  top éƒ½æœ‰   ç‚¹ä¸€ä¸‹  å°±æ‰§è¡Œäº†ä¸¤æ¬¡è¿™ä¸ªåŠ¨ç”»  å› æ­¤  è¿™é‡Œåˆ¤æ–­ä¸€ä¸‹2æ¬¡
                moveEnd(me)
                canMove = true     //ä»è¿™ä»¥å  å°±å¯ä»¥éšä¾¿ç‚¹äº†
            }
        }
    }
    const moveEnd = (me) => {
        me.ontransitionend = null
        me.setAttribute('onclick', '')
        moveList.appendChild(me)  //è¿™å°±æŠŠä¸Šé¢çš„èŠ‚ç‚¹è½¬ç§»åˆ°ä¸‹è¾¹æ¥äº†
        const findResult = [...moveList.children].filter(v => v.innerHTML === me.innerHTML)
        if (findResult.length === 3) {
            findResult.forEach(v => {
                v.ontransitionend = () => {
                    moveList.removeChild(v); //åŠ¨ç”»å®Œäº†ä»¥å æ¸…é™¤å…ƒç´    ä½†æ˜¯  è¿™æ ·è™½ç„¶æ¸…é™¤äº† å…ƒç´   å…ƒç´ ä¸èƒ½è‡ªåŠ¨å½’ä½
                    [...moveList.children].forEach((v, i) => {
                        v.style.left = `${i * size + moveList.offsetLeft}px`
                    })
                    //å¤±è´¥çš„è§„åˆ™
                    // if (moveList.children.length === 6) {
                    //     alert('å¤±è´¥')
                    //     return location.reload()
                    // } else if (main.children.length === 0) {
                    //     return alert('æ­å–œé€šå…³')
                    // }
                }
                setTimeout(() => v.style.transform = 'scale(0)') //åŠ¨ç”»æ¶ˆé™¤
            })
        }
        setTimeout(() => {
            if (moveList.children.length === 6) {
                alert('æ± å­å·²æ»¡ï¼Œæ¸¸æˆç»“æŸ')
                return location.reload()
            } else if (main.children.length === 0) {
                alert('æ­å–œé€šå…³')
                return location.reload()
            }
        }, 100)
        checkDisabled()   //è¿™ä¸ªé‡æ–°æ‰ç”¨æ˜¯ä¸ºäº†èƒ½å¤Ÿ åœ¨å¡ç‰‡é£˜ä¸‹æ¥ä»¥å  è¢«å‹çš„å¡ç‰‡  é¢œè‰²å˜æˆæ­£å¸¸
    }
    checkDisabled()
 
</script>
 
</html>